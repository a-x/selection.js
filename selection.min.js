(function(){var f,d,h,j;f={isPreceding:function(a,b){return b.compareDocumentPosition(a)&2},isText:function(a){return(a!=null?a.nodeType:void 0)===3},getChildIndex:function(a){var b;for(b=0;a=a.previousSibling;)b++;return b}};if(this.getSelection)this.Selection=d={hasSelection:function(a){var b;return(b=a.getSelection())&&b.focusNode!=null&&b.anchorNode!=null},getOrigin:function(a){var b;return!((b=a.getSelection())&&b.anchorNode!=null)?null:[b.anchorNode,b.anchorOffset]},getFocus:function(a){var b;
return!((b=a.getSelection())&&b.focusNode!=null)?null:[b.focusNode,b.focusOffset]},getStart:function(a){var b,e,c,g;if(!d.hasSelection(a))return null;c=d.getOrigin(a);b=c[0];e=c[1];g=d.getFocus(a);a=g[0];c=g[1];return f.isPreceding(b,a)||b===a&&e<c?[b,e]:[a,c]},getEnd:function(a){var b,e,c,g;if(!d.hasSelection(a))return null;c=d.getOrigin(a);b=c[0];e=c[1];g=d.getFocus(a);a=g[0];c=g[1];return f.isPreceding(b,a)||b===a&&e<c?[a,c]:[b,e]},setSelection:function(a,b,e,c,g){var d,f,i;d=a.document.createRange();
d.setStart(b,e);d.setEnd(c,g);try{(f=a.getSelection())!=null&&f.removeAllRanges()}catch(h){}return(i=a.getSelection())!=null?i.addRange(d):void 0}};else if(this.document.selection)h=function(a,b,e){var c,d,a=a.createElement("a");c=b.duplicate();c.collapse(e);for(d=c.parentElement();;)if(d.insertBefore(a,a.previousSibling),c.moveToElementText(a),!(c.compareEndPoints(e?"StartToStart":"StartToEnd",b)>0&&a.previousSibling!=null))break;c.compareEndPoints(e?"StartToStart":"StartToEnd",b)===-1&&a.nextSibling?
(c.setEndPoint(e?"EndToStart":"EndToEnd",b),b=a.nextSibling,e=c.text.length):(b=a.parentNode,e=f.getChildIndex(a));a.parentNode.removeChild(a);return[b,e]},j=function(a,b,e,c,d){var k,h,i;i=0;k=f.isText(c)?c:c.childNodes[d];h=f.isText(c)?c.parentNode:c;f.isText(c)&&(i=d);c=a.createElement("a");h.insertBefore(c,k||null);a=a.body.createTextRange();a.moveToElementText(c);c.parentNode.removeChild(c);b.setEndPoint(e?"StartToStart":"EndToEnd",a);return b[e?"moveStart":"moveEnd"]("character",i)},this.Selection=
d={hasSelection:function(a){var b;a.focus();return!a.document.selection?false:(b=a.document.selection.createRange())&&b.parentElement().document===a.document},getStart:function(a){var b;a.focus();if(!d.hasSelection(a))return null;b=a.document.selection.createRange();return h(a.document,b,true)},getEnd:function(a){var b;a.focus();if(!d.hasSelection(a))return null;b=a.document.selection.createRange();return h(a.document,b,false)},getOrigin:function(a){return d.getStart(a)},getFocus:function(a){return d.getEnd(a)},
setSelection:function(a,b,d,c,g){var f;f=a.document.body.createTextRange();j(a.document,f,false,c,g);j(a.document,f,true,b,d);return f.select()}};else throw new Exception("Browser has no selection support.");}).call(this);